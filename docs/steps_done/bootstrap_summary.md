# Bootstrap Summary

This document outlines the initial setup and architecture of the `chroma-lab` repository, established to host the Rust/WASM Quick Fix renderer.

## 1. Repository Structure

The repository is organized as a Rust workspace with a separate example application.

```
chroma-lab/
├── Cargo.toml              # Workspace root
├── pixi.toml               # Development environment & task runner configuration
├── package.json            # NPM scripts for building WASM and bundling
├── quickfix-renderer/      # Rust crate (WASM library)
│   ├── Cargo.toml
│   └── src/lib.rs          # Core logic (QuickFixAdjustments, process_frame)
├── examples/
│   └── minimal-viewer/     # Vite + React example app
│       ├── src/worker.ts   # Web Worker for off-main-thread processing
│       └── ...
└── .github/workflows/      # CI/CD configuration
```

## 2. Core Components

### `quickfix-renderer` (Rust Crate)

- **Target**: `wasm32-unknown-unknown`
- **Type**: `cdylib` (for dynamic linking with WASM host)
- **Tools**: `wasm-bindgen` is used to expose Rust structs and functions to JavaScript.
- **Features**:
  - `cpu` (Default): Deterministic CPU-based image processing.
  - `webgl2` / `webgpu`: Placeholders for future GPU backends.
- **API**:
  - `init()`: Initializes the WASM module (and panic hooks).
  - `QuickFixAdjustments`: Struct holding parameters (exposure, contrast, etc.).
  - `process_frame()`: Function to apply adjustments to an image buffer.

### `examples/minimal-viewer` (Example App)

- **Framework**: React + Vite + TypeScript.
- **Integration**: Directly links to the local `../pkg` directory generated by `wasm-pack`.
- **Architecture**:
  - Uses a **Web Worker** (`worker.ts`) to load the WASM module and perform heavy image processing.
  - The main thread handles UI (sliders, canvas) and sends messages to the worker.
  - This ensures the UI remains responsive even during intensive processing.

## 3. Build & Development Pipeline

We use **Pixi** to manage dependencies (Rust, Node.js, tools) and tasks.

### Key Commands

- **`pixi run dev`**: Starts the example app development server.
- **`pixi run build`**:
  1. Compiles Rust to WASM using `wasm-pack`.
  2. Outputs to `quickfix-renderer/pkg`.
  3. (Optional) Runs Vite build for bundling.
- **`pixi run test`**: Runs Rust unit tests.
- **`pixi run lint`**: Runs `cargo fmt` and `cargo clippy`.

### CI/CD

A GitHub Actions workflow (`.github/workflows/ci.yml`) is set up to:

1. Install Pixi.
2. Run Lint & Tests.
3. Build the WASM package.
4. Upload the generated `pkg` as an artifact.

## 4. Next Steps

- Implement the actual image processing algorithms in `quickfix-renderer` (CPU path).
- Add more adjustment parameters to `QuickFixAdjustments`.
- Implement GPU backends.
